#!/bin/bash

#####################################################
## Created by khan on Mon May 23 18:07:30 CDT 2011 ##
#####################################################

#minargs=0; usage="Usage: `basename $0`"
#if regmatch "$1" "^[\-]*h[^ ]*$" || [ "$#" -lt "$minargs" ]
#then echo $usage; exit 0; fi

cd /usr/local/bin
sPhrase='Automatically generated by MacApps2Cmd'

if [[ "$@" == *d* ]]; then
	## Remove existing files
	ls | \
	while read file; do
		if grep $sPhrase "$file"; then rm "$file"; fi
		if [ $? != 0 ]; then exit 1; fi
	done
fi

## Check verbosity
if [[ "$@" == *v* ]]; then bVerbose=true; else bVerbose=false; fi

## Add Apps
find / -maxdepth 6 -iname '*.app' 1>/tmp/allapps 2>/dev/null
cat /tmp/allapps | \
while read file; do
	output=`app2cmd "$file"`
	#	if ! grep -q "$sPhrase" $file; then
	#		echo "# $sPhrase." >> $output
	#	fi
	if $bVerbose; then echo "$file -> $output"; fi
done

## Make links
function LinkExisting() {
	if [ -e "$1" ]; then ln -sf "$1" "$2"; fi
}

#real lynx in /Applications/Lynxlet.app/Contents/Resources/lynx/bin/lynx
#LinkExisting Lynxlet lynx

