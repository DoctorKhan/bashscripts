#!/bin/bash

#######################################################
### Created by khan on Thu Jul 14 12:07:23 CDT 2011 ###
#######################################################

###################### Help Text ######################
# Usage: AppleCommands
#######################################################
if (( $# < 0 )) || [[ "$1" == *-h* ]]; then echo
	grep -A 99999 "# Help.*#*" $0 |\
	grep -E -m 2 -B 99999 "#{10,}"
echo; exit 0; fi
#######################################################

cd /usr/local/bin

while [[ "$1" == -* ]]; do
	## Remove existing files
	if [[ "$1" == -d ]]; then
		sPhrase="# Generated by"; ls |\
		while read file; do
			if grep -q $sPhrase "$file"; then
				if ! rm "$file"; then exit 1; fi
			fi
		done
	fi
	
	## Check verbosity
	bVerbose=`tester [ "$1" == "-v" ]`
	shift
done

# Find apps
echo "Finding apps..."
find /Applications /System /Developer /Library -iname '*.app' 1>/tmp/allapps 2>/dev/null

echo "Adding apps..."
# Add apps
nApps=`wc -l /tmp/allapps | awk '{print $1}'`
cat /tmp/allapps |\
while read file; do
	output=`App2Cmd "$file"`
	iPercent=$((++iApp*100/nApps));
	echo -en "\r$iApp / $nApps : $iPercent % : `fileparts 6 $output`"
done

echo

## Make links
#function LinkExisting() {
#	if [ -e "$1" ]; then ln -sf "$1" "$2"; fi
#}

#real lynx in /Applications/Lynxlet.app/Contents/Resources/lynx/bin/lynx
#LinkExisting Lynxlet lynx

# Dependencies: app2cmd, c, ec, es, li, MacApps2Cmd, regmatch, rep, ted
